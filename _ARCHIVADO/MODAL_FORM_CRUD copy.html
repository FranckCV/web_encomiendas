{% set is_consult = modo_modal == 'consult' %}
{% set is_update = modo_modal == 'update' %}
{% set is_insert = modo_modal == 'insert' %}

<div class="space_modal modal_crud_{{modo_modal}}" id="modal_crud_{{modo_modal}}{% if not is_insert %}_{{fila[primary_key]}}{% endif %}">
  {% if not is_consult %}
  <form class="modal_crud_content" action="{{ url_for('crud_' + modo_modal, tabla=tabla) }}" method="POST">
  {% else %}
  <div class="modal_crud_content">
  {% endif %}

    <div class="row">
      <h3>{{ NOMBRE_BTN_INSERT if is_insert else (NOMBRE_BTN_UPDATE if is_update else NOMBRE_BTN_CONSULT) }} {{nombre_tabla}}</h3>
    </div>

    <div class="row form_fields">
      {% if not is_insert %}
      <input type="hidden" id="{{primary_key}}" name="{{primary_key}}" value="{{fila[primary_key]}}">
      {% endif %}

      {% for campo in fields_form %}
      <div class="form_field form_{{campo[3]}}">
        <label for="{{campo[0]}}">{{campo[1]}}:</label>

        {% if campo[3] == 'select' %}
          {% set datos = campo[6][0]() if campo[6] and campo[6][0] is callable else campo[6][0] %}
          {% if is_consult %}
            <input id="{{campo[0]}}" name="{{campo[0]}}" type="text" value="{{ fila[campo[6][1]] }}" disabled>
          {% else %}
            <select id="{{campo[0]}}" name="{{campo[0]}}" {% if is_consult or campo[5]==False %}disabled{% endif %}>
              {% if is_insert %}
              <option value="-1" disabled selected>{{campo[2]}}</option>
              {% endif %}
              {% for option in datos %}
              <option value="{{option[0]}}" {% if not is_insert and fila[campo[0]]==option[0] %}selected{% endif %}>{{option[1]}}</option>
              {% endfor %}
            </select>
          {% endif %}
        
        {% elif campo[3] == 'textarea' %}
          <textarea id="{{campo[0]}}" name="{{campo[0]}}" {% if campo[4] %}required{% endif %} {% if is_consult or campo[5]==False %}disabled{% endif %}>
            {% if not is_insert %}{{ fila[campo[0]] }}{% endif %}
          </textarea>
        
        {% elif campo[3] == 'p' %}
          <div class="form_p_content">
            {% if campo[0] == 'activo' %}
              <p class="activo {% if fila[campo[0]] == 0 %}btn_unactive{% else %}btn_active{% endif %}">{{ STATE_0 if fila[campo[0]] == 0 else STATE_1 }}</p>
            {% else %}
              <p id="{{campo[0]}}" name="{{campo[0]}}">{{ fila[campo[0]] if not is_insert }}</p>
            {% endif %}
          </div>
        
        {% else %}
          {% set valor = fila[campo[0]] if not is_insert else '' %}
          {% set clase_extra = 'input_vacio' if valor == None or valor == '' else '' %}
          <input class="{{clase_extra}}" id="{{campo[0]}}" name="{{campo[0]}}" type="{{campo[3]}}" placeholder="{{campo[2]}}"
            value="{{valor}}" {% if campo[4] %}required{% endif %}
            {% if is_consult or campo[5]==False %}disabled{% endif %}>
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <div class="row">
      <div class="col">
        <div class="button btn_back" onclick="closeModal()">Cancelar</div>
      </div>
      <div class="col-1"></div>
      <div class="col">
        {% if is_consult %}
        <button class="button btn_acept" onclick="closeModal()">Aceptar</button>
        {% else %}
        <button class="button btn_acept" type="submit">Aceptar</button>
        {% endif %}
      </div>
    </div>

  {% if not is_consult %}
  </form>
  {% else %}
  </div>
  {% endif %}
</div>
