{% extends 'MAESTRA_GENERAL.html' %}
{% block estilos %}
  <link rel="stylesheet" href="/static/css/carrito.css" />
{% endblock %}
{% block titulo %}Carrito{% endblock titulo %}
{% block contenido %}
  <div class="container">
    <div class="cart-container">
      <div class="cart-items">
        <div class="cart-grid cart-header">
          <div style="grid-area: 1/1/1/3;">Artículos</div>
          <div>Precio unitario</div>
          <div>Cantidad</div>
          <div>Total</div>
        </div>

        <div class="cart-grid">
          <div class="item-image">📦</div>
          <div class="item-details">
            <div class="item-name">Caja pequeña</div>
            <div class="item-description">Caja de cartón resistente para paquetes pequeños (15x10x5 cm)</div>
          </div>
          <div class="item-price">$5.50</div>
          <div class="quantity-controls">
            <button class="quantity-btn" onclick="updateQuantity(1, -1)">-</button>
            <span class="quantity" id="qty-1">2</span>
            <button class="quantity-btn" onclick="updateQuantity(1, 1)">+</button>
          </div>
          <div class="item-total">$11.20</div>
          <button class="remove-btn" onclick="removeItem(1)"><i class="fa-solid fa-trash"></i></button>
        </div>

        <div class="cart-grid">
          <div class="item-image">📦</div>
          <div class="item-details">
            <div class="item-name">Caja mediana</div>
            <div class="item-description">Caja de cartón reforzada para paquetes medianos (30x20x15 cm)</div>
          </div>
          <div class="item-price">$8.75</div>
          <div class="quantity-controls">
            <button class="quantity-btn" onclick="updateQuantity(2, -1)">-</button>
            <span class="quantity" id="qty-2">1</span>
            <button class="quantity-btn" onclick="updateQuantity(2, 1)">+</button>
          </div>
          <div class="item-total">$11.20</div>
          <button class="remove-btn" onclick="removeItem(2)"><i class="fa-solid fa-trash"></i></button>
        </div>

        <div class="cart-grid">
          <div class="item-image">🧴</div>
          <div class="item-details">
            <div class="item-name">Plástico de burbujas (1m²)</div>
            <div class="item-description">Material protector para objetos frágiles</div>
          </div>
          <div class="item-price">$3.25</div>
          <div class="quantity-controls">
            <button class="quantity-btn" onclick="updateQuantity(3, -1)">-</button>
            <span class="quantity" id="qty-3">3</span>
            <button class="quantity-btn" onclick="updateQuantity(3, 1)">+</button>
          </div>
          <div class="item-total">$11.20</div>
          <button class="remove-btn" onclick="removeItem(3)"><i class="fa-solid fa-trash"></i></button>
        </div>

        <div class="cart-grid">
          <div class="item-image">📜</div>
          <div class="item-details">
            <div class="item-name">Cinta de embalaje</div>
            <div class="item-description">Cinta adhesiva resistente para sellar paquetes (50m)</div>
          </div>
          <div class="item-price">$4.50</div>
          <div class="quantity-controls">
            <button class="quantity-btn" onclick="updateQuantity(4, -1)">-</button>
            <span class="quantity" id="qty-4">2</span>
            <button class="quantity-btn" onclick="updateQuantity(4, 1)">+</button>
          </div>
          <div class="item-total">$11.20</div>
          <button class="remove-btn" onclick="removeItem(4)"><i class="fa-solid fa-trash"></i></button>
        </div>
      </div>

      <div class="cart-summary">
        <div class="summary-card">
          <div class="summary-title">Resumen del pedido</div>

          <div class="summary-row">
            <span>Subtotal</span>
            <span id="subtotal">$38.50</span>
          </div>

          <div class="summary-row">
            <span>IGV (18%)</span>
            <span id="taxes">$6.16</span>
          </div>

          <div class="summary-row total-row">
            <span>Total</span>
            <span id="total">$44.66</span>
          </div>

          <button class="checkout-btn"><span class="icon">💳</span> Ir a pagar</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
{% block script %}
  <script>
    const TAX_RATE = 0.18;

    // Datos iniciales de los productos
    const products = [
      { id: 1, name: 'Caja pequeña', price: 5.5, quantity: 2 },
      { id: 2, name: 'Caja mediana', price: 8.75, quantity: 1 },
      { id: 3, name: 'Plástico de burbujas (1m²)', price: 3.25, quantity: 3 },
      { id: 4, name: 'Cinta de embalaje', price: 4.5, quantity: 2 }
    ];

    // Actualizar cantidad de un producto
    function updateQuantity(productId, change) {
      const product = products.find(p => p.id === productId);
      if (product) {
        const newQuantity = product.quantity + change;
        if (newQuantity >= 1) {
          product.quantity = newQuantity;
          document.getElementById(`qty-${productId}`).textContent = newQuantity;

          // Actualizar el total del producto
          const totalElement = document.getElementById(`total-${productId}`);
          totalElement.textContent = `$${(product.price * newQuantity).toFixed(2)}`;

          updateTotals();
        }
      }
    }

    // Eliminar un producto del carrito
    function removeItem(productId) {
      const index = products.findIndex(p => p.id === productId);
      if (index !== -1) {
        products.splice(index, 1);
        const itemElement = document.getElementById(`item-${productId}`);

        // Animación de salida
        itemElement.style.transition = 'all 0.3s ease';
        itemElement.style.opacity = '0';
        itemElement.style.height = '0';
        itemElement.style.overflow = 'hidden';

        setTimeout(() => {
          itemElement.remove();
          if (products.length === 0) {
            showEmptyCart();
          }
          updateTotals();
        }, 300);
      }
    }

    // Mostrar carrito vacío
    function showEmptyCart() {
      const cartItems = document.querySelector('.cart-items');
      cartItems.innerHTML = `
        <div class="cart-grid cart-header">
          <div style="grid-area: 1/1/1/3;">Artículos</div>
          <div>Precio unitario</div>
          <div>Cantidad</div>
          <div>Total</div>
        </div>
        <div class="empty-cart">
          <h3>Tu carrito está vacío</h3>
          <p>Agrega productos de embalaje para continuar</p>
        </div>
      `;
    }

    // Actualizar totales generales
    function updateTotals() {
      const subtotal = products.reduce((sum, p) => sum + p.price * p.quantity, 0);
      const taxes = subtotal * TAX_RATE;
      const total = subtotal + taxes;

      document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
      document.getElementById('taxes').textContent = `$${taxes.toFixed(2)}`;
      document.getElementById('total').textContent = `$${total.toFixed(2)}`;
    }

    // Llamado inicial para asegurar consistencia
    window.onload = () => {
      products.forEach(p => {
        const totalElement = document.getElementById(`total-${p.id}`);
        if (totalElement) {
          totalElement.textContent = `$${(p.price * p.quantity).toFixed(2)}`;
        }
      });
      updateTotals();
    };
  </script>
{% endblock %}
